{"https://moirai2.github.io/schema/daemon/input":"$input","https://moirai2.github.io/schema/daemon/bash":["unmap1=\"$workdir/unmap1.fq.gz\"","multicount=`perl $workdir/filter.pl $input $unmap1`"],"https://moirai2.github.io/schema/daemon/script":{"https://moirai2.github.io/schema/daemon/script/name":"$workdir/filter.pl","https://moirai2.github.io/schema/daemon/script/code":["use strict 'vars';","use File::Basename;","my $input=$ARGV[0];","my $filtered=$ARGV[1];","my $basename=basename($input);","my $multimapcount=0;","open(IN,\"samtools view $input |\");","open(FILTERED,\"|gzip>$filtered\");","while(<IN>){","if(/^@/){next;}","chomp;s/\\r//g;","my ($qname,$flag,$rname,$pos,$mapq,$cigar,$rnext,$pnexxt,$tlen,$seq,$qual,@others)=split(/\\t/);","if(($flag&256)>0){next;}","my $multi=0;","if(($flag&4)==0){$multi=1;}","foreach my $other(@others){if($other=~/uT:A:3/){$multi=1;}}","if($multi){$multimapcount++;}","else{print FILTERED \"\\@$qname\\n$seq\\n+\\n$qual\\n\";}","}","close(IN);","close(FILTERED);","print \"$multimapcount\\n\";"]},"https://moirai2.github.io/schema/daemon/output":["$unmap1","$multicount"]}
