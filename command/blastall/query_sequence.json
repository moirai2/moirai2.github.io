{"http://localhost/~ah3q/schema/daemon/select":["$sequence->http://localhost/~ah3q/schema/daemon/execute->$nodeid","$nodeid->http://localhost/~ah3q/schema/daemon/command->$this"],"http://localhost/~ah3q/schema/daemon/bash":["output=\"$tmpdir/$sequence.txt\"","status=$(perl $tmpdir/query.pl $sequence $output)"],"http://localhost/~ah3q/schema/daemon/script":{"http://localhost/~ah3q/schema/daemon/script/name":"$tmpdir/query.pl","http://localhost/~ah3q/schema/daemon/script/code":["use URI::Escape;","use LWP::UserAgent;","use HTTP::Request::Common qw(POST);","$ua=LWP::UserAgent->new;","my $query=$ARGV[0];","my $output=$ARGV[1];","$program=\"blastn&MEGABLAST=on\";","$database=\"nt\";","$encoded_query.=uri_escape($query);","$args=\"CMD=Put&PROGRAM=$program&DATABASE=$database&QUERY=$encoded_query\";","$req=new HTTP::Request POST=>'https://blast.ncbi.nlm.nih.gov/blast/Blast.cgi';","$req->content_type('application/x-www-form-urlencoded');","$req->content($args);","$response=$ua->request($req);","$response->content=~/^    RID = (.*$)/m;","$rid=$1;","sleep 30;","open(OUT,\">$output\");","while (true){","$req=new HTTP::Request GET=>\"https://blast.ncbi.nlm.nih.gov/blast/Blast.cgi?CMD=Get&FORMAT_OBJECT=SearchInfo&RID=$rid\";","$response=$ua->request($req);","if($response->content=~/\s+Status=WAITING/m){sleep 5;next;}","elsif($response->content=~/\s+Status=FAILED/m){print \"failed\\n\";}","elsif($response->content=~/\s+Status=UNKNOWN/m){print \"unknown\\n\";}","elsif($response->content=~/\s+Status=READY/m){print \"success\\n\";last;}","else{print \"failed\\n\";}","}","sleep 30;","$req=new HTTP::Request GET=>\"https://blast.ncbi.nlm.nih.gov/blast/Blast.cgi?CMD=Get&FORMAT_TYPE=Text&RID=$rid\";","$response=$ua->request($req);","print OUT $response->content;","close(OUT);"]},"http://localhost/~ah3q/schema/daemon/output":["$output","$status"]}
